# hello-consumer 模块的应用名字，也是微服务的默认名字
spring:
  application:
    name: hello-consumer-service
  main:
    allow-bean-definition-overriding: true
    allow-circular-references: true
  cloud:
    nacos:
      discovery:
        enabled: false  # 禁用Spring Cloud自动服务发现，避免与Dubbo冲突
    sentinel:
      transport:
        dashboard: 127.0.0.1:8858

provider:
  name: 127.0.0.1:8081

logging:
  level:
#    包名天然用.分隔，不管是 YAML 还是 Properties，这个.都必须保留；
    cloud.tangyuan.helloconsumer.HelloFeignService: DEBUG
#    类名的命名空间也天然用: 分隔。
    feign: DEBUG
    feign.Logger: DEBUG
    feign.Request: DEBUG
    feign.Response: DEBUG

feign:
  sentinel:
    enabled: true  # 启用Feign的Sentinel断路器功能，必须配置才能使用fallback
  compression:
    request:
      enabled: true
      mime-types: text/*, application/*, application/json, application/xml, text/xml
      min-request-size: 2048
    response:
      enabled: true
  client:
    config:
      hello-provider-service:
        connectTimeout: 1000    #   连接超时的时间为 1s
        readTimeout: 5000       #   连接超时的时间为 5s
      hello-consumer-service:
        connectTimeout: 2000
        readTimeout: 10000

# Dubbo 配置
dubbo:
  application:
    name: ${spring.application.name}
    owner: developer
    organization: cloud.tangyuan
    register-mode: all  # 同时注册接口级和应用级
    register-consumer: true  # Dubbo 3.2.0中启用消费者注册的正确配置
    parameters:
      application: ${spring.application.name}  # 显式传递应用名给Nacos
      appname: ${spring.application.name}  # 兼容不同版本的Nacos客户端
      dubbo.application.name: ${spring.application.name}  # Dubbo应用名称
      q3s.service-discovery.migration.step: APPLICATION_FIRST
  qos:
    enable: false  # 禁用QOS服务，避免端口22222冲突
  # 全局超时和重试配置
  consumer:
    timeout: 3000  # 全局消费者超时时间
    retries: 3  # 全局重试次数
    check: false  # 启动时不检查服务是否存在
    loadbalance: roundrobin
  cloud:
    subscribed-service: hello-provider-service
  registry:
    address: nacos://127.0.0.1:8810?backup=127.0.0.1:8820,127.0.0.1:8830
    username: nacos
    password: nacos
    timeout: 10000
    parameters:
      application: ${spring.application.name}  # 在注册中心配置中显式指定应用名称
      appname: ${spring.application.name}
      registry.type: service
      registry.simplified: false
      registry.useAsConfigCenter: false
      registry.useAsMetadataCenter: false
  protocol:
    name: dubbo
    port: -1
  monitor:
    protocol: registry
  metadata-report:
    address: nacos://127.0.0.1:8810

# Nacos客户端配置
nacos:
  client:
    application:
      name: ${spring.application.name}  # 明确设置Nacos客户端应用名称
